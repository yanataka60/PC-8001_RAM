                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.28.0, LST:Full:4
       5EBD                     MONDME      EQU     5EBDH       ;16進データ2桁表示
       5EC0                     MONDHL      EQU     5EC0H       ;16進4桁表示
       5FCA                     MONCLF      EQU     5FCAH       ;CRコード及びLFコードの表示
       5FD4                     MONSPC      EQU     5FD4H       ;スペースの表示
       52ED                     MSGOUT      EQU     52EDH       ;文字列の出力2
                                
000000 9000                                 ORG     9000H
                                
                                ;******** 事前にRAMに書き込み *********************
000000 9000 210000          10              LD      HL,0000H    ;書込開始アドレス
000003 9003 110080          10              LD      DE,8000H    ;書込終了アドレス+1
                                
000006 9006 CD9090          17              CALL    WRTRAM      ;RAMへ書込みに切り替え
000009 9009 7D               4  LOP0:       LD      A,L
00000A 900A 77               7              LD      (HL),A      ;RAM書込
00000B 900B 23               6              INC     HL          ;書込開始アドレス+1
00000C 900C E5              11              PUSH    HL
00000D 900D A7               4              AND     A
00000E 900E ED52            15              SBC     HL,DE       ;書込開始アドレスが書込終了アドレス以下ならループ
000010 9010 E1              10              POP     HL
000011 9011 20F6            12              JR      NZ,LOP0
                                
                                ;******** RAM CHECK START **************
000013 9013 210000          10              LD      HL,0000H    ;CHECK開始アドレス
000016 9016 110080          10              LD      DE,8000H    ;CHECK終了アドレス+1
                                            
000019 9019 CDCA5F          17  LOP1:       CALL    MONCLF      ;改行
00001C 901C CDC05E          17              CALL    MONDHL      ;CHECKアドレス表示
00001F 901F CDD45F          17              CALL    MONSPC      ;空白
                                
000022 9022 7D               4              LD      A,L
000023 9023 CD9D90          17              CALL    PRINTA      ;書込んだはずのDATAを表示
000026 9026 CD8990          17              CALL    CHGRAM      ;RAMへ切り替え
000029 9029 7E               7              LD      A,(HL)      ;RAM読込
00002A 902A CD9790          17              CALL    CHGROM      ;ROMへ切り替え
00002D 902D CD9D90          17              CALL    PRINTA      ;RAMから読み出したDATAを表示
000030 9030 BD               4              CP      L           ;読込DATA比較
000031 9031 2038            12              JR      NZ,ERR      ;一致しなければERR
                                            
000033 9033 CDD45F          17              CALL    MONSPC      ;空白
                                
000036 9036 3E55             7              LD      A,55H       ;書込DATA
000038 9038 CD9D90          17              CALL    PRINTA      ;書込DATA表示
00003B 903B CD8990          17              CALL    CHGRAM      ;RAMへ切り替え
00003E 903E 77               7              LD      (HL),A      ;CHECK DATA 書込
00003F 903F 7E               7              LD      A,(HL)      ;CHECK DATA 読込
000040 9040 CD9790          17              CALL    CHGROM      ;ROMへ切り替え
000043 9043 CD9D90          17              CALL    PRINTA      ;読込DATA表示
000046 9046 FE55             7              CP      55H         ;読込DATA比較
000048 9048 2021            12              JR      NZ,ERR      ;一致しなければERR
                                            
00004A 904A 3EAA             7              LD      A,0AAH      ;書込DATA
00004C 904C CD9D90          17              CALL    PRINTA      ;書込DATA表示
00004F 904F CD8990          17              CALL    CHGRAM      ;RAMへ切り替え
000052 9052 77               7              LD      (HL),A      ;CHECK DATA 書込
000053 9053 7E               7              LD      A,(HL)      ;CHECK DATA 読込
000054 9054 CD9790          17              CALL    CHGROM      ;ROMへ切り替え
000057 9057 CD9D90          17              CALL    PRINTA      ;読込DATA表示
00005A 905A FEAA             7              CP      0AAH        ;読込DATA比較
00005C 905C 200D            12              JR      NZ,ERR      ;一致しなければERR
                                            
00005E 905E 23               6              INC     HL          ;CHECK開始アドレス+1
00005F 905F E5              11              PUSH    HL
000060 9060 A7               4              AND     A
000061 9061 ED52            15              SBC     HL,DE       ;CHECK開始アドレスがCHECK終了アドレス以下ならループ
000063 9063 E1              10              POP     HL
000064 9064 20B3            12              JR      NZ,LOP1
000066 9066 217290          10              LD      HL,MSG_OK
000069 9069 1803            12              JR      MSG
                                
00006B 906B 217C90          10  ERR:        LD      HL,MSG_ERR
00006E 906E CDED52          17  MSG:        CALL    MSGOUT
000071 9071 76               4              HALT
                                
000072 9072 52414D204F4B210D    MSG_OK:     DB      'RAM OK!',0DH,0AH,00H
            0A00                
                                
00007C 907C 52414D204552524F    MSG_ERR:    DB      'RAM ERROR!',0DH,0AH,00H
            52210D0A00          
                                
       9089                     CHGRAM:                         ;RAMへ切り替え
000089 9089 F5              11              PUSH    AF
00008A 908A 3E11             7              LD      A,11H
00008C 908C D3E2            11              OUT     (0E2H),A
00008E 908E F1              10              POP     AF
00008F 908F C9              10              RET
                                
       9090                     WRTRAM:                         ;RAMへ書き込み
000090 9090 F5              11              PUSH    AF
000091 9091 3E10             7              LD      A,10H
000093 9093 D3E2            11              OUT     (0E2H),A
000095 9095 F1              10              POP     AF
000096 9096 C9              10              RET
                                
       9097                     CHGROM:                         ;ROMへ切り替え
000097 9097 F5              11              PUSH    AF
000098 9098 AF               4              XOR     A
000099 9099 D3E2            11              OUT     (0E2H),A
00009B 909B F1              10              POP     AF
00009C 909C C9              10              RET
                                
       909D                     PRINTA:                         ;Aレジスタの内容を16進数2桁で表示
00009D 909D F5              11              PUSH    AF
00009E 909E E5              11              PUSH    HL
00009F 909F 21AC90          10              LD      HL,WORKA
0000A2 90A2 77               7              LD      (HL),A
0000A3 90A3 CDBD5E          17              CALL    MONDME
0000A6 90A6 CDD45F          17              CALL    MONSPC
0000A9 90A9 E1              10              POP     HL
0000AA 90AA F1              10              POP     AF
0000AB 90AB C9              10              RET
                                
       90AC                     WORKA:      DS      1
                                
                                            END
[EOF:RAMCHECK.s:SHIFT_JIS]
